  \chapter{Backups mit dem RMAN}
    \setcounter{page}{1}\kapitelnummer{chapter}
    \minitoc
\newpage
    \section{Backups anfertigen}
      Backups werden im RMAN mit dem Kommando \languagerman{BACKUP}
      durchgef\"uhrt. Dabei sind  unterschiedliche Arten von Backups, wie z. B.
      Hot- oder Coldbackups, Full oder Incremental Backups m\"oglich.
      \subsection{Hot- oder Coldbackup}
        Ob ein Backup ein Hot- oder ein Coldbackup wird, h\"angt vom Status der Datenbank ab. Ist die Datenbank ge\"offnet, wird das Backups als Hotbackup (inkonsistentes Backup) bezeichnet. Ist die Datenbank im Mount-Status, ist es ein Coldbackup (konsistentes Backup). Die beiden folgenden Beispiele zeigen, wie Hot- bzw. Coldbackups durchgef\"uhrt werden k\"onnen.
        \begin{lstlisting}[caption={Ein Coldbackup durchf\"uhren},label=admin1300,language=rman,alsolanguage=sqlplus]
RMAN> shutdown immediate

RMAN> startup mount

RMAN> BACKUP database;
        \end{lstlisting}
        \begin{lstlisting}[caption={Ein Hotbackup durchf\"uhren},label=admin1301,language=rman,emph={[9]ALTER,OPEN,DATABASE},emphstyle={[9]\color{magenta}\bfseries}]
RMAN> SQL 'ALTER DATABASE OPEN';

RMAN> BACKUP database;
          \end{lstlisting}
      \subsection{Das BACKUP-Kommando}
        Das \languagerman{BACKUP}-Kommando verwendet die vorkonfigurierten Einstellungen und Standardeinstellungen des RMAN. Soll jedoch von diesen Einstellungen abgewichen werden, kann dies durch die Angabe von Parametern geschehen.
        \subsubsection{Das Backup-Ausgabeger\"at festlegen}
          Das \languagerman{BACKUP}-Kommando kennt die Klausel \languagerman{DEVICE TYPE}. Sie gibt an, ob das Backup auf einen Datentr\"ager oder einem SBT-Ger\"at gespeichert werden soll. In den beiden folgenden Beispielen wird die \languagerman{SHOW}-Anweisung dazu benutzt, um die aktuelle Channel-Einstellung vor dem Backup anzuzeigen.
\clearpage
          \begin{lstlisting}[caption={Ein Backup to Disk},label=admin1302,language=rman]
RMAN> SHOW CHANNEL;

RMAN configuration parameters for database with db_unique_name ORCL are:
RMAN configuration has no stored or default parameters

RMAN> BACKUP DEVICE TYPE disk database;
          \end{lstlisting}
          \begin{lstlisting}[caption={Ein Backup to Tape},label=admin1303,language=rman]
RMAN> SHOW CHANNEL;

using target database control file instead of recovery catalog
RMAN configuration parameters for database with db_unique_name ORCL are:
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE'
PARMS  'SBT_LIBRARY=oracle.disksbt,ENV=(BACKUP_DIR=/u04)';

RMAN> BACKUP DEVICE TYPE sbt database;
          \end{lstlisting}
        \subsubsection{Image Copy oder Backup Set?}
          Um ein Backup als Image Copy anzufertigen gibt es die \languagerman{AS COPY}-Klausel. Image Copies k\"onnen nur auf Disk-, aber nicht auf SBT-Ger\"ate gespeichert werden.
          \begin{lstlisting}[caption={Eine Image Copy der Datenbank erstellen},label=admin1304,language=rman]
RMAN> BACKUP AS COPY database;
          \end{lstlisting}
          Das Gegenst\"uck zur \languagerman{AS COPY}-Klausel ist die \languagerman{AS BACKUPSET}-Klausel.
          \begin{lstlisting}[caption={Ein Backup Set der Datenbank erstellen},label=admin1305,language=rman]
RMAN> BACKUP AS BACKUPSET database;
        \end{lstlisting}
        \subsubsection{Kompression verwenden}
          RMAN ist in der Lage Backup Sets zu komprimieren, um Speicherplatz zu sparen. Das Erstellen komprimierter Backup Sets ben\"otigt jedoch mehr Zeit als die Erstellung normaler Backup Sets.
          \begin{merke}
            Kompression kann f\"ur Image Copies nicht angewendet werden.
          \end{merke}
          \begin{lstlisting}[caption={Ein komprimiertes Backup Set der Datenbank erstellen},label=admin1306,language=rman]
RMAN> BACKUP AS COMPRESSED BACKUPSET database;
          \end{lstlisting}
        \subsubsection{Den Speicherort des Backups angeben}
          Mit Hilfe der \languagerman{FORMAT}-Klausel des \languagerman{BACKUP}-Kommandos kann angegeben werden, wo das Backup gespeichert werden soll. Standardm\"a\ss{}ig werden Backups in der Fast Recovery Area gespeichert.
          \begin{lstlisting}[caption={Den Speicherort des Backups \"andern},label=admin1307,language=rman]
RMAN> BACKUP database FORMAT = '/u04/backup/%d_%D-%M-%Y_%t_%s_%p.bkp';
          \end{lstlisting}
          Der folgenden Literaturhinweis erl\"autert die Bedeutung der einzelnen Platzhalter.
          \begin{literaturinternet}
            \item \cite[formatSpec]{formatSpec}.
          \end{literaturinternet}
      \subsubsection{Backups mit Tags versehen}
          RMAN h\"angt an jedes Backup einen kurzen Kommentar an, der als \enquote{Tag}\footnote{tag = engl. Schild} bezeichnet wird und zur besseren Identifizierung dient. Um manuell ein Tag an ein Backup anzuh\"angen, gibt es die \languagerman{TAG}-Klausel im \languagerman{BACKUP}-Kommando.
          \begin{lstlisting}[caption={Ein Backup mit manuellem Tag versehen},label=admin1308,language=rman]
RMAN> BACKUP database TAG = 'Full-Backup 28.10.13';
          \end{lstlisting}
      \subsection{Full-Backups}
        Unter einem Full-Backup (Vollsicherung) wird die vollst\"andige Sicherung
        \begin{itemize}
          \item einer Datendatei,
          \item eines Tablespaces,
          \item oder einer Datenbank verstanden.
        \end{itemize}
        Das Gegenst\"uck zur Vollsicherung ist die inkrementelle Sicherung.
        \subsubsection{Backup einer Datenbank}
          \beispiel{admin1309} zeigt die einfachste Variante eines kompletten Backups einer Datenbank.
          \begin{lstlisting}[caption={Backup einer ganzen Datenbank},label=admin1309,language=rman,emph={[9]ALTER,SYSTEM,ARCHIVE,LOG,CURRENT},emphstyle={[9]\color{magenta}\bfseries}]
RMAN> BACKUP database;
RMAN> SQL 'ALTER SYSTEM ARCHIVE LOG CURRENT';
          \end{lstlisting}
          Das Kommando \languagerman{BACKUP database} fertigt das Backup der Datenbank an. Im zweiten Schritt werden mit dem Kommando \languageorasql{ALTER SYSTEM ARCHIVE LOG CURRENT} die aktiven Redo Logs gewechselt (Log Switch) und archiviert. Somit wird sichergestellt, dass alle f\"ur das Recovery mit diesem Backup ben\"otigten Redo Logs archiviert wurden. Wird dieses Backup als Hotbackup durchgef\"uhrt, sollten anschliessend noch die Archive Logs gesichert werden.
        \subsubsection{Backups einzelner Tablespaces}
          Um ein Backup eines oderer mehrerer Tablespaces durchzuf\"uhren, gibt es das Kommando \languagerman{BACKUP tablespace}. Im folgenden Beispiel werden die beiden Tablespaces \identifier{users} und \identifier{bank} auf ein SBT-Ger\"at gesichert.
          \begin{lstlisting}[caption={Backup eines Tablespace},label=admin1310,language=rman,emph={[9]ALTER,SYSTEM,ARCHIVE,LOG,CURRENT},emphstyle={[9]\color{magenta}\bfseries}]
RMAN> BACKUP DEVICE TYPE sbt tablespace users, bank;
RMAN> SQL 'ALTER SYSTEM ARCHIVE LOG CURRENT';
          \end{lstlisting}
        \subsubsection{Backups einzelner Datendateien}
          Um einzelne Datendateien sichern zu k\"onnen, gibt es das Kommando \languagerman{BACKUP datafile}. Wenn beispielsweise die Datendateien mit den Nummern 1, 2 und 4 gesichert werden sollen, k\"onnte dies wie folgt geschehen:
          \begin{lstlisting}[caption={Backup einzelner Datendateien},label=admin1311,language=rman]
RMAN> BACKUP datafile 1, 2, 4;
          \end{lstlisting}
          \begin{merke}
            Ist das Controlfile Autobackup aktiviert, wird anschliessend an dieses Backup, automatisch ein Backup Set mit der aktuellen Kontrolldatei und der Serverparameterdatei angelegt. Ist das Controlfile Autobackup deaktiviert, werden die aktuelle Kontrolldatei und die Serverparameterdatei automatisch in das Backupset der Datendateien integriert, da Tablespace Nummer 1 gesichert wurde.
          \end{merke}
          Um die Nummern der Datendateien herauszufinden kann die View \identifier{dba\_data\_files} wie folgt benutzt werden:
          \begin{lstlisting}[caption={Herausfinden der Datendateinummern},label=admin1312,language=oracle_sql]
SQL> SELECT   file_id, file_name, tablespace_name
  2  FROM     dba_data_files
  3  ORDER BY tablespace_name, file_id;
          \end{lstlisting}
      \subsection{Inkrementelle Backups}
        F\"uhrt der RMAN ein inkrementelles Backup durch, sichert er nur die Datenbl\"ocke, die sich seit einem bestimmten Backup, welches als Referenz angegeben wurde, ge\"andert haben. Inkrementelle Backups k\"onnen sowohl von ganzen Datenbanken als auch von Tablespaces und Datendateien durchgef\"uhrt werden.

        Es gibt verschiedene Begr\"undungen, warum inkrementelle Backups in eine Backup-Stra\-te\-gie mit einbezogen werden sollten:
        \begin{itemize}
          \item Reduzieren des Zeitaufwands f\"ur t\"agliche Backups
          \item Netzwerkbandbreite durch kleinere Datenmengen einsparen
        \end{itemize}
        \subsubsection{Wie funktionieren inkrementelle Backups?}
          Jeder Datenblock in einer Oracle Datenbank f\"uhrt in seinem Header eine System Change Number (SCN). Dies ist immer die SCN, die w\"ahrend der letzten Ver\"anderung am Datenblock aktuell war. W\"ahrend eines inkrementellen Backups liest RMAN die SCN jedes Datenblocks und vergleicht diese mit der SCN des Referenzbackups. Ist die SCN im Datenblock gr\"o\ss{}er, als die SCN im Referenzbackup, wird der Datenblock gesichert.

          Inkrementelle Backups k\"onnen als Level 0 oder als Level 1 Backups angelegt werden. Ein Level 0 Backup sichert alle Datenbl\"ocke genau wie ein normales Full-Backup. Der einzige Unterschied ist, dass ein normales Full-Backup nicht in eine inkrementelle Backup-Strategie integriert werden kann.

          F\"ur Level 1 Backups gibt es zwei verschiedene Arten:
          \begin{itemize}
            \item \textbf{Inkrementelles Backup}: Es werden alle Datenbl\"ocke gesichert, die sich seit dem letzten Level 1 oder Level 0 Backup ge\"andert haben.
            \item \textbf{Kumulatives Backup}: Es werden alle Datenbl\"ocke gesichert, die sich seit dem letzten Level 0 Backup ge\"andert haben.
          \end{itemize}
           Inkrementelle Backups sparen Speicherplatz und Zeit w\"ahrend des Backupvorgangs, da unter Umst\"anden weniger Datenbl\"ocke gesichert werden m\"ussen, als bei einem kumulativen Backup.

          Der Vorteil der kumulativen Backups liegt darin, das die Recovery-Zeit geringer ist, als bei den Inkrementellen. Bei inkrementellen Backups m\"ussen alle Backups, seit dem letzten Level 0 Backup in der richtigen Reihenfolge wiederhergestellt werden. Bei kumulativen Backups muss nur das aktuellste Backup seit dem letzten Level 0 Backup aufgespielt werden.
        \subsubsection{Level 0 Backups durchf\"uhren}
          Die Grundlage einer jeden inkrementellen Backupstrategie sind Level 0 Backups. Egal welche Art von Level 1 Backups gemacht wird, die Art und Weise wie Level 0 Backups erstellt werden, bleibt davon unber\"uhrt. \beispiel{admin1313} zeigt verschiedene Varianten eines Level 0 Backups.
          \begin{lstlisting}[caption={Inkrementelles Level 0 Backup},label=admin1313,language=rman]
-- Level 0 Backup der Datenbank
RMAN> BACKUP INCREMENTAL LEVEL 0 database;
-- Level 0 Backup eines Tablespaces
RMAN> BACKUP INCREMENTAL LEVEL 0 tablespace bank;
-- Level 0 Backup einer Datendatei
RMAN> BACKUP INCREMENTAL LEVEL 0 datafile 1;
          \end{lstlisting}
        \subsubsection{Level 1 Backups durchf\"uhren}
          Zur Durchf\"uhrung eines Level 1 Backups wird lediglich die Klausel \languagerman{LEVEL 0} durch \languagerman{LEVEL 1} ersetzt. Hierbei handelt es sich dann um ein inkrementelles Backup.
          \begin{lstlisting}[caption={Inkrementelles Level 1 Backup der Datenbank},label=admin1314,language=rman]
RMAN> BACKUP INCREMENTAL LEVEL 1 database;
          \end{lstlisting}
          \abbildung{differentiel_backup} zeigt ein Beispiel, in dem an jedem Sonntag ein inkrementelles Level 0 Backup durchgef\"uhrt wird. Dieses dient dann als Referenzbackup f\"ur das Level 1 Backup, welches am darauf folgenden Montag erstellt wird. Das Level 1 Backup vom Montag gilt dann wiederum als Referenzbackup f\"ur das Level 1 Backup am Dienstag, bis am n\"achsten Sonntag wieder ein Level 0 Backup erstellt wird und die Kette von vorne beginnt.

          \bild{Eine inkrementelle Backup\-strategie}{differentiel_backup}{1}

        \subsubsection{Kumulative Backups durchf\"uhren}
          Um kumulative Backups durchzuf\"uhren, muss zus\"atzlich zur \languagerman{INCREMENTAL LEVEL N}-Klausel noch das Schl\"usselwort \languagerman{CUMULATIVE} angegeben werden.
          \bild{Eine kumulative Backup\-strategie}{cumulative_backup}{1}
          \begin{lstlisting}[caption={Kumulatives Level 1 Backup der Datenbank},label=admin1315,language=rman]
RMAN> BACKUP INCREMENTAL LEVEL 1 CUMULATIVE database;
          \end{lstlisting}
      \subsection{Backups der Archive Logs durchf\"uhren}
        \label{backupderarchivelogsdurchfuehren}
        \subsubsection{Separate Sicherung der Archive Logs}
          Archive Logs sind der Schl\"ussel zu einer erfolgreichen Backup und Recoverystrategie, weshalb sie regelm\"assig gesichert werden sollten. \"Ahnlich wie Kontrolldateien k\"onnen Archive Logs als eigenes Backup Set gesichert oder in einem anderen Backup Set mitgesichert werden. Um ein manuelles Backup der Archive Logs durchzuf\"uhren gibt es die \languagerman{ARCHIVELOG-ALL}-Klausel des \languagerman{BACKUP}-Kommandos.
          \begin{lstlisting}[caption={Manuelles Backup aller Archive Logs},label=admin1316,language=rman]
RMAN> BACKUP archivelog ALL;
          \end{lstlisting}
          Anders als bei den Datendateien, muss bei der Sicherung der Archive Logs immer angegeben werden, welche Archive Logs zu sichern sind. In \beispiel{admin1316} wird das Schl\"usselwort \languagerman{ALL} benutzt, um alle Archive Logs zu sichern. Es gibt jedoch noch andere M\"oglichkeiten, um die Menge der zu sichernden Archive Logs einzuschr\"anken.
          \begin{lstlisting}[caption={Alle Archive Logs ab Sequenz Nummer 4711 sichern},label=admin1317,language=rman]
RMAN> BACKUP archivelog
2>    FROM SEQUENCE 4711;
          \end{lstlisting}
          \begin{lstlisting}[caption={Alle Archive Logs bis Sequenz Nummer 4711 sichern},label=admin1318,language=rman]
RMAN> BACKUP archivelog
2>    UNTIL SEQUENCE 4711;
          \end{lstlisting}
          \begin{lstlisting}[caption={Alle Archive Logs zwischen Sequenz Nummer 666 und 4711 sichern},label=admin1319,language=rman]
RMAN> BACKUP archivelog
2>    SEQUENCE BETWEEN 666 AND 4711;
          \end{lstlisting}
          Wie in \ref{administeringarchivelogs} bereits erw\"ahnt, sollte aus Sicherheitsgr\"unden die Archivierung der Log Dateien immer an mehreren Speicherorten erfolgen. Wenn nun mehrere identische Kopien einer Archive Log Datei existieren, wird der RMAN immer nur die erste verf\"ugbare Kopie sichern. Archive Logs gelten als identische wenn folgende Attribute gleich sind:
          \begin{itemize}
            \item die Datenbank ID (DBID),
            \item die Log Thread Number (Laufende Nummer des LGWr-Prozesses, nur in RAC-Umgebungen relevant)
            \item die Log Sequence Number
            \item die Reset Logs SCN
          \end{itemize}
        \subsubsection{Archive Logs mitsichern}
          Eine andere Variante ist die Archive Logs beim Backup der Datenbank oder eines Teils der Datenbank mitzusichern. Dies geschieht durch die Klausel \languagerman{PLUS archivelog}, die dem \languagerman{BACKUP}-Kommando angeh\"angt werden kann.
          \begin{lstlisting}[caption={Manuelles Backup des Archive Logs},label=admin1320,language=rman]
RMAN> BACKUP database PLUS archivelog;
        \end{lstlisting}
        Nach dem Absetzen dieses Kommandos f\"uhrt der RMAN folgende Schritte durch:
        \begin{enumerate}
          \item Es wird ein Log Switch herbeigef\"uhrt.
          \item RMAN f\"uhrt das Kommando \languagerman{BACKUP archivelog ALL} aus.
          \item Das Backup der Datenbank wird angelegt.
          \item Es wird erneut ein Log Switch herbeigef\"uhrt
          \item Das Kommando \languagerman{BACKUP archivelog ALL} wird ein zweites mal ausgef\"uhrt.
        \end{enumerate}
        Damit wird sichergestellt, das alle Archive Logs, die vor und w\"ahrend des Backups entstanden sind mitgesichert werden.
        \subsubsection{Gesicherte Archive Logs automatisch l\"oschen}
          RMAN bietet die M\"oglichkeit, Archive Logs automatisch, nach ihrer Sicherung zu l\"oschen. Dies erspart ein manuelles Eingreifen des Administrators. Um die Archive Logs automatisch zu l\"oschen, muss eine der beiden Klauseln \languagerman{DELETE INPUT} oder \languagerman{DELETE ALL INPUT} an das \languagerman{BACKUP ARCHIVELOG}-Kommando ange\"angt werden. Der Unterschied zwischen diesen Klauseln liegt darin, welche Archive Logs gel\"oscht werden:
          \begin{itemize}
            \item \languagerman{DELETE INPUT}: Es werden nur die Kopien einer Archive Log Datei gel\"oscht, die vom RMAN zur Sicherung benutzt wurden. Alle anderen Kopien bleiben erhalten.
            \item \languagerman{DELETE ALL INPUT}: Es werden alle Kopien einer Archive Log Datei gel\"oscht, auch die, welche nicht zur Sicherung benutzt wurden.
          \end{itemize}
          \bild{Auto\-matisches l\"oschen der Archive Logs}{delete_input_and_delete_all_input}{1.5}
          \beispiel{admin1321} zeigt die Anwendung der \languagerman{DELETE ALL INPUT}-Klausel.
          \begin{lstlisting}[caption={Manuelles Backup und gleichzeitiges L\"oschen der Archive Logs},label=admin1321,language=rman]
RMAN> BACKUP archivelog ALL
2>    DELETE ALL INPUT;
          \end{lstlisting}
    \subsection{Backups der Fast Recovery Area anfertigen}
      \label{FRABackups}
      In verschiedenen F\"allen kann es sinnvoll sein, den Inhalt der Fast
      Recovery Area auf Band zu sichern. Eine einfache Vorgehensweise beim
      Sichern der Fast Recovery Area k\"onnte sein:
\clearpage
      \begin{enumerate}
        \item Festlegen einer passenden Backup Retention Policy
        \item Backup der Datenbank durchf\"uhren
        \item Sichern der Fast Recovery Area auf Band
        \item Obsolete Backups der Fast Recovery Area von den B\"andern l\"oschen
        \item Obsolete Datenbankbackups aus der Fast Recovery Area l\"oschen
      \end{enumerate}

      \begin{lstlisting}[caption={Sichern der Fast Recovery Area},label=admin1322,language=rman]
RMAN> CONFIGURE RETENTION POLICY TO REDUNDANCY 2;

RMAN> RUN {
2>      ALLOCATE CHANNEL c_disk
3>      DEVICE TYPE disk;
4>      ALLOCATE CHANNEL c_sbt
5>      DEVICE TYPE sbt
6>      PARMS  'SBT_LIBRARY=oracle.disksbt,ENV=(BACKUP_DIR=/u04)';
7>
8>      BACKUP CHANNEL c_disk database;
9>      BACKUP CHANNEL c_sbt  recovery area;
10>    }
RMAN> DELETE obsolete;
      \end{lstlisting}
      \begin{merke}
        Der Inhalt der Fast Recovery Area kann mittels \languagerman{BACKUP RECOVERY AREA} auf SBT gesichert werden. Eine Sicherung auf Festplatte ist nicht m\"oglich.
      \end{merke}
      \subsection{Manuelle Kontrolldatei-Backups}
        \subsubsection{Backup mit dem RMAN}
          RMAN benutzt ein \enquote{Snapshot Controfile}, um konsistente Backups der Kontrolldatei anzufertigen. Ist das Controlfile Autobackup-Feature des RMAN aktiviert, macht RMAN automatisch Backups der Kontrolldatei und der Serverparameterdatei nach jedem Backup und jeder Struktur\"anderung der Datenbank. Ist dieses Feature nicht aktiviert, sollten regelm\"assig manuelle Backups der Kontrolldatei erfolgen. Dies kann auf unterschiedliche Arten geschehen:
        \begin{itemize}
          \item Durch das RMAN-Kommando \languagerman{BACKUP current controlfile}
          \item In dem eine Kopie der Kontrolldatei in das aktuelle Backup aufgenommen wird
          \item Durch das Sichern von Datendatei Nummer 1, da dabei die Kontrolldatei immer automatisch mitgesichert wird. Dies geschieht zum Beispiel im Rahmen eines Daten\-bank-Backups.
        \end{itemize}
        Damit die Kontrolldatei bei einem beliebigen Backup mitgesichert werden
        kann, gibt es die Klausel \languagerman{INCLUDE current controlfile}.
        \begin{lstlisting}[caption={Kontrolldatei in ein Backup mit einschlie\ss{}en},label=admin1323,language=rman]
RMAN> BACKUP tablespace bank
2>    INCLUDE current controlfile;
        \end{lstlisting}
        \subsubsection{Backup to Trace}
          Oracle stellt eine zweite Variante zur Sicherung des Controlfiles zur Verf\"ugung: Das Backup to Trace. Hierbei wird keine Bin\"ar-Kopie, sondern ein SQL-Skript erstellt, mit dessen Hilfe die Kontrolldatei neu kreiert werden kann. Erzeugt wird dieses Skript mit Hilfe des SQL-Kommandos \languageorasql{ALTER DATABASE BACKUP}.
        \begin{lstlisting}[caption={Kontrolldatei in ein Backup mit einschlie\ss{}en},label=admin1324,language=oracle_sql]
SQL> ALTER DATABASE
  2  BACKUP CONTROLFILE TO TRACE
  3  AS '/home/oracle/control.bkp';
        \end{lstlisting}
        Und so sieht es aus:
        \begin{lstlisting}[caption={Das \languageorasql{CREATE CONTROLFILE}-Skript},label=admin1325,language=oracle_sql]
startup nomount
CREATE CONTROLFILE REUSE DATABASE "ORCL" NORESETLOGS  ARCHIVELOG
    MAXLOGFILES 16
    MAXLOGMEMBERS 3
    MAXDATAFILES 100
    MAXINSTANCES 8
    MAXLOGHISTORY 292
LOGFILE
  GROUP 1 '/u01/app/oracle/oradata/orcl/redo01.log'  SIZE 50M BLOCKSIZE 512,
  GROUP 2 '/u01/app/oracle/oradata/orcl/redo02.log'  SIZE 50M BLOCKSIZE 512,
  GROUP 3 '/u01/app/oracle/oradata/orcl/redo03a.log'  SIZE 50M BLOCKSIZE 512,
  GROUP 4 '/u01/app/oracle/oradata/orcl/redo04a.log'  SIZE 50M BLOCKSIZE 512,
  GROUP 5 (
    '/u01/app/oracle/oradata/orcl/redo05a.log',
    '/u02/oradata/orcl/redo05b.log'
  ) SIZE 50M BLOCKSIZE 512

DATAFILE
  '/u01/app/oracle/oradata/orcl/system01.dbf',
  '/u01/app/oracle/oradata/orcl/sysaux01.dbf',
  '/u01/app/oracle/oradata/orcl/undotbs01.dbf',
  '/u01/app/oracle/oradata/orcl/users01.dbf',
  '/u01/app/oracle/oradata/orcl/example01.dbf',
  '/u01/app/oracle/oradata/orcl/bank01.dbf'
CHARACTER SET WE8MSWIN1252;
          \end{lstlisting}
          \beispiel{admin1325} zeigt nur einen Ausschnitt aus dem \languageorasql{CREATE CONTROLFILE}-Skript.

          Interessant ist ein solches Skript immer dann, wenn Probleme mit der Datenbank auftreten, die sich auf dem \enquote{offiziellen} Weg nicht l\"osen lassen. Dies ist unter anderem dann der Fall, wenn alle Dateien der Current Redo Log Group besch\"adigt sind.
      \subsection{Backup des SPFile}
        Das SPFile wird in verschiedenen Situationen automatisch mitgesichert (siehe \ref{controlfileautobackup}). Um ein manuelles Backup des SPFile durchzuf\"uhren gibt es das folgende Kommando:
        \begin{lstlisting}[caption={Manuelles Backup des SPFile},label=admin1326,language=rman]
RMAN> BACKUP spfile;
          \end{lstlisting}
      \subsection{Backupduplexing konfigurieren}
        Es ist m\"oglich RMAN so zu konfigurieren, dass von jedem Backuppiece mehrere identische Kopien angefertigt werden. Dieses Features ist als \enquote{duplexing} bekannt und bezieht sich nur auf Backup Sets, nicht aber auf Image Copies.
        \begin{lstlisting}[caption={Konfigurieren des Backupduplexing},label=admin1327,language=rman]
RMAN> CONFIGURE DATAFILE BACKUP COPIES
2>    FOR DEVICE TYPE disk TO 2;
RMAN> CONFIGURE ARCHIVELOG BACKUP COPIES
2>    FOR DEVICE TYPE sbt TO 2;

RMAN> BACKUP database PLUS ARCHIVELOG
2>    FORMAT '/u02/backups/%U', '/u03/backups/%U';
        \end{lstlisting}
        \beispiel{admin1327} zeigt, wie sowohl f\"ur Datendateien, als auch f\"ur Archive Log Dateien, das Backup Duplexing auf den Wert zwei konfiguriert wird. RMAN erstellt zwei identische Kopien der Datendateien und verteilt diese auf die beiden Speicherorte \oscommand{/u02/backups} und \oscommand{/u03/backups}. Ein solcher Formatstring kann mit Hilfe eines der Kommandos \languagerman{BACKUP}, \languagerman{CONFIGURE CHANNEL} oder \languagerman{ALLOCATE CHANNEL} angegeben werden.
        \begin{merke}
          Zu beachten ist dabei, dass das Backup Duplexing nicht zusammen mit der Fast Recovery Area funktioniert. Dies wird durch die folgende Fehlermeldung angezeigt:
          \begin{verbatim}
ORA-19806: cannot make duplex backups in recovery area.
          \end{verbatim}
          Aus diesem Grund muss immer ein Format-String verwendet werden, der die Duplexkopien ausserhalb der Fast Recovery Area speichert. Es k\"onnen maximal 4 identische Kopien eines Backups erzeugt werden.
        \end{merke}
    \section{Backups verwalten}
      \subsection{Backups katalogisieren}
        In bestimmten Situationen kann es notwendig sein, dass Image Copies, Backupsets oder Archive Logs im RMAN Repository oder im RMAN Katalog neu erfasst werden m\"ussen. Ein solcher Fall tritt ein, wenn:
        \begin{itemize}
          \item Kopien von Datendateien ohne Zuhilfenahme des RMAN angefertigt wurden. Diese k\"onnen dann als Datafile Copies im Repository/Katalog registriert werden.
          \item Backup Pieces ohne RMAN auf dem Datentr\"ager verschoben wurden.
          \item Backup Pieces aus dem Repository gel\"oscht wurden, die Dateien selbst aber noch existieren und wiederverwendet werden sollen.
          \item die Kontrolldatei verloren geht und kein Recovery Katalog genutzt wird.
          \end{itemize}
        \begin{lstlisting}[caption={Backup Pieces katalogisieren},label=admin1328,language=rman]
RMAN> CATALOG BACKUPPIECE  '/u03/backup/backup_820.bkp',
2>                         '/u04/backup/backup_821.bkp';
        \end{lstlisting}
        In \beispiel{admin1328} wird RMAN versuchen beide Backup Pieces zu katalogisieren. Er wird seine Arbeit auch dann fortsetzen, wenn eines der beiden Pieces defekt ist. Es wird dann nur das Funktionsf\"ahige ins Repository aufgenommen. Soll ein aus mehreren Pieces bestehendes Backup Set katalogisiert werden, gelingt dies nur, wenn alle Pieces fehlerfrei sind.
        \begin{lstlisting}[caption={Datendatei-Kopien katalogisieren},label=admin1329,language=rman]
RMAN> CATALOG DATAFILECOPY '/u03/backup/bank01.dbf';
        \end{lstlisting}
        \begin{lstlisting}[caption={Archive Logs katalogisieren},label=admin1330,language=rman]
RMAN> CATALOG ARCHIVELOG   '/u03/backup/archive1_731.dbf',
2>                         '/u03/backup/archive1_732.dbf';
        \end{lstlisting}
        Es ist m\"oglich, den Inhalt eines gesamten Verzeichnisses, in einem Arbeitsschritt zu katalogisieren.
        \begin{lstlisting}[caption={Verzeichnisinhalt katalogisieren},label=admin1331,language=rman]
RMAN> CATALOG START WITH '/disk1/backups/';
        \end{lstlisting}
        Bei dieser Art des Katalogisierens, muss beachtet werden, dass es sich bei der Angabe von \oscommand{/disk1/backups/} nicht um einen Verzeichnisnamen handelt, sondern nur um ein Prefix. Wird \oscommand{/disk1/backups} angegeben, werden alle Verzeichnisse, die mit dieser Zeichenkette beginnen, z. B. \oscommand{/disk1/backupsets} oder \oscommand{/disk1/backups-jahr-2013} ebenfalls katalogisiert. Dies kann dazu f\"uhren, dass unbeabsichtigt  Dateien in den Recovery Katalog aufgenommen werden.

        \begin{merke}
          Um solche Probleme zu vermeiden, sollte das Prefix immer mit einem / abgeschlossen werden, also z. B. \oscommand{/disk1/backups/}.
        \end{merke}
      \subsection{Backup-Crosschecks durchf\"uhren}
        Ein Crosscheck vergleicht den Recovery Katalog mit dem Inhalt des Dateisystems, um Unterschiede festzustellen. Wenn z. B. ein Nutzer ein Backup Set mit Betriebssystemmitteln von der Festplatte l\"oscht, existiert trotzdem noch der Eintrag f\"ur dieses Backup Set im Recovery Katalog. Mit Hilfe des \languagerman{CROSSCHECK}-Kommandos k\"onnen solche Inkonsistenzen bereinigt werden.
        Nach einem Crosscheck bekommt jeder Eintrag im RMAN einen Status:
        \begin{itemize}
          \item \textbf{EXPIRED}: Das Backup ist nicht auf dem Dateisystem verf\"ugbar.
          \item \textbf{AVAILABLE}: Das Backup ist verf\"ugbar und darf genutzt werden.
          \item \textbf{UNAVAILABLE}: Das Backup ist verf\"ugbar, darf aber nicht durch den RMAN genutzt werden.
        \end{itemize}
        \begin{merke}
          Der Status expired sollte nicht mit dem Status obsolete verwechselt werden.
        \end{merke}
        Die Ergebnisse eines Crosschecks k\"onnen direkt im RMAN, mit Hilfe des \languagerman{LIST}-Kommandos oder in SQL*PLUS, mit Hilfe der View \identifier{v\$backup\_files} betrachtet werden. W\"ahrend eines Crosschecks werden keine Dateien von der Festplatte und auch keine RMAN-Eintr\"age gel\"oscht. Lediglich der Status eines Eintrags wird ver\"andert. Um Backups zu l\"oschen, muss das \languagerman{DELETE}-Kommando des RMAN verwendet werden (siehe \ref{deletingbackups}).
        Einfache Beispiele f\"ur die Nutzung des \languagerman{CROSSCHECK}-Kommandos k\"onnten so aussehen:
        \begin{lstlisting}[caption={\languagerman{CROSSCHECK} aller Backups},label=admin1332,language=rman]
RMAN> CROSSCHECK backup;
        \end{lstlisting}
        Bei der Angabe von \languagerman{BACKUP} werden alle Arten von Backups
        \"uberpr\"uft. Es gibt verschieden M\"oglichkeiten, um die Menge der zu
        \"uberpr\"ufenden Backups einzuschr\"anken.
\clearpage
        \begin{lstlisting}[caption={\languagerman{CROSSCHECK} auf Backup Sets beschr\"anken},label=admin1333,language=rman]
RMAN> CROSSCHECK backupset;

RMAN> CROSSCHECK backupset 666, 815, 4711;

RMAN> CROSSCHECK backupset TAG = 'nightly_backup';
        \end{lstlisting}
        Das erste Kommando pr\"uft alle vorhandenen Backup Sets. Das zweite nur die Backup Sets mit den IDs 666, 815 und 4711. Das dritte \languagerman{CROSSCHECK}-Kommando checkt nur das Backup Piece mit dem Tag \enquote{nightly\_backup}.
        \begin{lstlisting}[caption={Nur Datafile Copies checken},label=admin1334,language=rman]
RMAN> CROSSCHECK datafilecopy ALL;

RMAN> CROSSCHECK datafilecopy 113, 114, 115;
        \end{lstlisting}
        Wird der Crosscheck auf Datafilecopies, Archive Logs oder Controlfilecopies angewendet, muss in jedem Fall die Menge der zu pr\"ufenden Dateien angegeben werden.
        \begin{lstlisting}[caption={Alle Arten von Copies (Datafilecopy, Archive Logs, Controlfilecopy) checken},label=admin1335,language=rman]
RMAN> CROSSCHECK copy;
        \end{lstlisting}
      \subsection{Manuelle Status\"anderungen an Backups}
        Mit Hilfe des \languagerman{CHANGE}-Kommandos kann der Status eines Backups manuell auf \enquote{available} oder \enquote{unavailable} gesetzt werden. Da der RMAN sich selbst die f\"ur eine Wiederherstellung notwendigen Backups sucht, ist es immer dann sinnvoll, ein Backup Set als \enquote{unavailable} zu markieren, wenn der RMAN es nicht f\"ur das Restore benutzen darf.
        \begin{merke}
          Zu beachten ist, dass Dateien die sich in der Fast Recovery Area befinden, nicht als \textit{unavailable} markiert werden k\"onnen.
        \end{merke}
        \begin{lstlisting}[caption=Manuelle Status\"anderung eines Backup Sets auf unavailable,label=admin1336,language=rman]
RMAN> CHANGE BACKUPSET 12 UNAVAILABLE;
        \end{lstlisting}
        \begin{lstlisting}[caption=Das Backup Set wieder verf\"ugbar machen,label=admin1337,language=rman]
RMAN> CHANGE BACKUPSET 12 AVAILABLE;
        \end{lstlisting}
        \begin{merke}
          Manuelle Status\"anderungen sind auch f\"ur Datafilecopies, Controlfilecopies und alle anderen Arten von Backups m\"oglich.
        \end{merke}
      \subsection{Backups l\"oschen}
        \label{deletingbackups}
        \subsubsection{Bestimmte Backups l\"oschen}
          In regelm\"a\ss{}igen Abst\"anden ist es notwendig, Backups zu l\"oschen und Platz f\"ur Neue zu schaffen. Diese Arbeit sollte immer mit dem RMAN-Kommando \languagerman{DELETE} verrichtet werden, da nicht nur die Dateien gel\"oscht, sondern auch das RMAN Repository gepflegt werden muss. Es bedient sich grunds\"atzlich der gleichen Syntax, wie der \languagerman{CROSSCHECK}-Befehl.
          \begin{lstlisting}[caption=Alle vorhandenen Backups l\"oschen,label=admin1338,language=rman]
RMAN> DELETE backup;
          \end{lstlisting}
          \begin{lstlisting}[caption=Nur Backup Sets l\"oschen,label=admin1339,language=rman]
RMAN> DELETE backupset;

RMAN> DELETE backupset 666, 815, 4711;
          \end{lstlisting}
          \languagerman{DELETE backupset} l\"oscht alle Backup Sets, w\"ahrend durch die Angabe von Backup Set IDs nur bestimmte Backup Sets gel\"oscht werden.
          \begin{lstlisting}[caption=Archive Logs l\"oschen,label=admin1340,language=rman]
RMAN> DELETE ARCHIVELOG ALL;

RMAN> DELETE ARCHIVELOG
2>    UNTIL SEQUENCE = 200;
          \end{lstlisting}
          \begin{merke}
            Gerade beim L\"oschen von Archive Logs ist gr\"o\ss{}te Vorsicht geboten!
          \end{merke}
          RMAN fragt vor dem L\"oschen jeder Datei nach. Diese Nachfrage kann durch die Angabe von \languagerman{DELETE NOPROMPT} unterbunden werden.
        \subsubsection{Obsolete Backups l\"oschen}
          Die Backup Retention Policy legt fest, welche Backups f\"ur ein Recovery ben\"otigt werden und welche nicht (siehe \ref{backupretentionpolicy}). Verst\"o\ss{}t ein Backup gegen die Retention Policy, wird es als \enquote{obsolete} markiert. Obsolete Backups k\"onnen mittels \languagerman{DELETE}-Befehl gel\"oscht werden.
          \begin{lstlisting}[caption=Obsolete Backups l\"oschen,label=admin1341,language=rman]
RMAN> DELETE obsolete;
          \end{lstlisting}
        \subsubsection{Expired-Backups l\"oschen}
          Wird ein Crosscheck ausgef\"uhrt, um den Inhalt des Recovery Katalogs
          mit dem Dateisystem zu vergleichen, werden Backups die zwar noch im
          Katalog eingetragen sind, aber auf dem Dateisystem nicht mehr
          existieren auf den Status \textit{expired} gesetzt. Mit dem Kommando
          \languagerman{DELETE EXPIRED} k\"onnen solche Eintr\"age anschliessend
          entfernt werden. Sollte die zu dem Eintrag geh\"orende Datei noch
          existieren, wird sie ebenfalls gel\"oscht.

          Folgender Vorgang l\"oscht alle als \textit{expired} markierten
          Backups:
          \begin{enumerate}
            \item Durchf\"uhren eines Crosschecks.
              \begin{lstlisting}[caption={CROSSCHECK durchf\"uhren},label=admin1342,language=rman]
CROSSCHECK backup;
              \end{lstlisting}
            \item L\"oschen der als \textit{expired} markierten Backups.
              \begin{lstlisting}[caption={L\"oschen der Backups},label=admin1343,language=rman]
DELETE EXPIRED backup;
              \end{lstlisting}
          \end{enumerate}
      \section{Block Change Tracking}
        Das \enquote{Block Change Tracking}-Feature des RMAN erh\"oht die Performance inkrementeller Backups dadurch, dass Informationen \"uber ge\"anderte Bl\"ocke in einem \enquote{Trackingfile} gespeichert werden. Wenn RMAN das Trackingfile benutzt, entf\"allt das Durchsuchen der Datenbank nach ge\"anderten Bl\"ocken.

        Das erste Level 0 Backup, nach dem Einschalten des Block Change Tracking, zieht noch keinen Nutzen daraus, da das Trackingfile noch nicht den aktuellen Stand in der Datenbank wiedergeben kann. Aber bereits das n\"achste Level 1 Backup, kann die Informationen im Trackingfile nutzen.

        \begin{merke}
          Durch die Nutzung von Block Change Tracking \"andert sich nichts an den Backup- oder Recovery-Kommandos.
        \end{merke}

        Standardm\"a\ss{}ig ist das Block Change Tracking deaktiviert, da es geringe Performanceeinbussen, im normalen Betrieb der Datenbank mit sich bringt. Der Performancegewinn bei der Durchf\"uhrung inkrementeller Backups, mit gro\ss{}en Datenmengen, ist jedoch sehr hoch.

        Das Trackingfile kann an einem beliebigen Ort auf dem Datentr\"ager gespeichert werden. Oracle empfiehlt es in der Fast Recovery Area (Standardspeicherort) abzulegen.

        \begin{merke}
          Im Trackingfile werden f\"ur bis zu acht inkrementelle Backups (ein Level 0 plus sieben Level 1) die Trackinginformationen gespeichert. Sobald ein weiteres Level 1 Backup angelegt wird, werden die Informationen zum ersten Backup (Level 0) \"uberschrieben.
        \end{merke}
        Um dieses Feature zu aktivieren, muss ein Trackingfile angegeben werden. Dies kann nur geschehen, wenn die Datenbank ge\"offnet oder in der Mount-Phase ist.
        \begin{lstlisting}[caption={Block Change Tracking
        aktivieren},label=admin1344,language=oracle_sql]
SQL> ALTER DATABASE
  2  ENABLE BLOCK CHANGE TRACKING
  3  USING FILE '/u02/rman_change_track.f' REUSE;
        \end{lstlisting}
        Die \languageorasql{USING FILE}-Klausel gibt den Pfad und den Dateinamen des Tracking\-files an. Das Schl\"us\-sel\-wort \languageorasql{REUSE} sorgt daf\"ur, dass eine evtl. bereits bestehende Datei \"uberschrieben wird.

        Verwenden Sie die Klausel \languageorasql{DISABLE BLOCK CHANGE TRACKING}, um das Block Change Tracking zu deaktivieren.
        \begin{lstlisting}[caption={Block Change Tracking deaktivieren},label=admin1345,language=oracle_sql]
SQL> ALTER DATABASE
  2  DISABLE BLOCK CHANGE TRACKING;
        \end{lstlisting}
        Mit Hilfe der View \identifier{v\$block\_change\_tracking} kann man ersehen, ob das Block Change Tracking aktiviert ist. Sie enth\"alt eine Spalte \identifier{status}, die den Zustand des Block Change Trackings angibt.
        \begin{lstlisting}[caption={Den Status des Block Change Trackings \"uberpr\"ufen},label=admin1346,language=oracle_sql,alsolanguage=sqlplus]
SQL> col status format a8 
SQL> col filename format a30
SQL> col bytes format 999,999.00
SQL> SELECT *
  2  FROM v$block_change_tracking;

STATUS   FILENAME                             BYTES
-------- ------------------------------ -----------
DISABLED
        \end{lstlisting}
        \begin{literaturinternet}
          \item \cite{BRADV89537}
        \end{literaturinternet}
    \section{Das Kommando LIST}
      Das Kommando \languagerman{LIST} benutzt das RMAN Repository, um
      verschiedene Informationen \"uber Backups und Archive Logs anzuzeigen. Es
      ist nur dann funktionsf\"ahig, wenn eine Verbindung zur Zieldatenbank
      besteht.
      \subsection{Auflistungen gruppieren}
        \languagerman{LIST} kann Backups auf zwei Arten anzeigen:
        \begin{itemize}
          \item Gruppiert nach Backup: Zu jedem Backup werden die zugeh\"origen Dateien angezeigt.
          \item Gruppiert nach Datei: Zu jeder Datei wird das betreffende Backup angezeigt.
        \end{itemize}
        \subsubsection{Nach Backup gruppieren}
          \begin{lstlisting}[caption={\languagerman{LIST} - Alle Backups, gruppiert nach Backup anzeigen},label=admin1347, language=rman]
RMAN> LIST backup;

using target database control file instead of recovery catalog

List of Backup Sets
===================


BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
1       Full    591.36M    &DISK&        00:01:00     24-OCT-13
        BP Key: 1   Status: &AVAILABLE&  Compressed: NO  Tag: TAG20131024T141243
        Piece Name: /u05/fast_recovery_area/ORCL/backupset/201...
  List of Datafiles in backup &set& 1
  File LV Type Ckp &SCN&    Ckp Time  Name
  ---- -- ---- ---------- --------- ----
  1       Full 2054849    24-OCT-13 /u01/app/oracle/oradata/orcl/system01.dbf

BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
2       Full    9.36M      &DISK&        00:00:04     24-OCT-13
        BP Key: 2   Status: &AVAILABLE&  Compressed: NO  Tag: TAG20131024T141243
        Piece Name: /u05/fast_recovery_area/ORCL/backupset/201...
  &SPFILE& Included: Modification time: 23-OCT-13
  &SPFILE& db_unique_name: ORCL
  Control File Included: Ckp &SCN&: 2054873      Ckp time: 24-OCT-13
          \end{lstlisting}
          \begin{lstlisting}[caption={\languagerman{LIST} - Bestimmte Backup Sets, gruppiert nach Backup anzeigen},label=admin1348,language=rman]
RMAN> LIST backupset 666, 815, 4711;
          \end{lstlisting}
        \subsubsection{Nach Datei gruppieren}
          Um in umgekehrter Folge zu Gruppieren, muss dem
          \languagerman{LIST}-Kommando der Zusatz \languagerman{BY FILE}
          mitgegeben werden.

          \begin{lstlisting}[caption={\languagerman{LIST} - Backups, gruppiert nach Backup Datei anzeigen},label=admin1349,language=rman]
RMAN> LIST backup BY FILE;


List of Datafile Backups
========================

File Key     TY LV S Ckp &SCN&    Ckp Time  #Pieces #Copies Compressed Tag
---- ------- -  -- - ---------- --------- ------- ------- ---------- ---
1    1       B  F  A 2054849    24-OCT-13 1       1       NO         TAG2013...
2    7       B  F  A 2076573    27-OCT-13 1       1       NO         TAG2013...
6    5       B  F  A 2062383    25-OCT-13 1       1       NO         TAG2013...
     3       B  F  A 2054959    24-OCT-13 1       1       NO         TAG2013...
7    3       B  F  A 2054959    24-OCT-13 1       1       NO         TAG2013...

List of Control File Backups
============================

CF Ckp &SCN& Ckp Time  BS Key  S #Pieces #Copies Compressed Tag
---------- --------- ------- - ------- ------- ---------- ---
2076573    27-OCT-13 8       A 1       1       NO         TAG20131028T093159
2062392    25-OCT-13 6       A 1       1       NO         TAG20131025T112454
2054967    24-OCT-13 4       A 1       1       NO         TAG20131024T141608
2054873    24-OCT-13 2       A 1       1       NO         TAG20131024T141243
List of &SPFILE& Backups
======================

Modification Time BS Key  S #Pieces #Copies Compressed Tag
----------------- ------- - ------- ------- ---------- ---
27-OCT-13         8       A 1       1       NO         TAG20131028T093159
23-OCT-13         6       A 1       1       NO         TAG20131025T112454
23-OCT-13         4       A 1       1       NO         TAG20131024T141608
23-OCT-13         2       A 1       1       NO         TAG20131024T141243
          \end{lstlisting}
        \subsubsection{Anzeigen einer Zusammenfassung}
          Mit \languagerman{LIST ... SUMMARY} kann f\"ur jeden beliebigen Backuptyp eine Zusammenfassung angezeigt werden. Diese enth\"alt nur noch die wesentlichsten Informationen, in geraffter Form.
\clearpage
          \begin{lstlisting}[caption={Anzeigen einer Zusammenfassung},label=admin1350,language=rman]
RMAN> LIST backup SUMMARY;

List of Backups
===============
Key     TY LV S Device Type Completion Time #Pieces #Copies Compressed Tag
------- -- -- - ----------- --------------- ------- ------- ---------- ---
1       B  F  A &DISK&        24-OCT-13       1       1       NO        TAG2013...
2       B  F  A &DISK&        24-OCT-13       1       1       NO        TAG2013...
3       B  F  A &DISK&        24-OCT-13       1       1       NO        TAG2013...
4       B  F  A &DISK&        24-OCT-13       1       1       NO        TAG2013...
5       B  F  A SBT_TAPE    25-OCT-13       1       1       NO        TAG2013...
6       B  F  A SBT_TAPE    25-OCT-13       1       1       NO        TAG2013...
7       B  F  A &DISK&        28-OCT-13       1       1       NO        TAG2013...
8       B  F  A &DISK&        28-OCT-13       1       1       NO        TAG2013...
          \end{lstlisting}
      \subsection{Auflisten der Expired Backups}
        Es ist m\"oglich sich solche Backups anzeigen zu lassen, die im Repository als \enquote{expired} markiert sind.
          \begin{lstlisting}[caption={Expired Backups auflisten},label=admin1351,language=rman]
RMAN> LIST expired backup;

List of change, crosscheck, and delete Backup Sets
===================
BS Key  Size       Device Type Elapsed Time Completion Time
------- ---------- ----------- ------------ ---------------
7       136M       disk        00:00:20     04-NOV-12
        BP Key: 7   Status: available  Compressed: NO  Tag: TAG2012...
        Piece Name: /u05/fast_recovery_area/backup/2003_11_04/...
  List of Archived Logs in backup set 7
  Thrd Seq     Low scn    Low Time  Next scn   Next Time
  ---- ------- ---------- --------- ---------- ---------
  1    1       173832     21-OCT-12 174750     21-OCT-03
  1    2       174750     21-OCT-12 174755     21-OCT-03
  1    3       174755     21-OCT-12 174758     21-OCT-03

  1    37      533321     01-NOV-12 575472     03-NOV-03
  1    38      575472     03-NOV-12 617944     04-NOV-03
  1    39      617944     04-NOV-12 631495     04-NOV-03
BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
8       Full    2M         disk        00:00:01     04-NOV-12
        BP Key: 8   Status: available  Compressed: NO  Tag: TAG2012...
        Piece Name: /u05/fast_recovery_area/c-774627068-20121104-01
  Controlfile Included: Ckp scn: 631510       Ckp time: 04-NOV-12
  spfile Included: Modification time: 21-OCT-12
          \end{lstlisting}
      \subsection{Ausgew\"ahlte Backups anzeigen}
        Anbei noch einige Beispiele, die zeigen, wie verschiedenste Backups zur Auflistung ausgew\"ahlt werden k\"onnen.
        \begin{lstlisting}[caption={Auflistungen eingrenzen},label=admin1352,language=rman]
# Nur Full-Backups der Datenbank anzeigen
RMAN> LIST backup OF database;

# Image Copies einer bestimmten Datendatei anzeigen
RMAN> LIST copy OF datafile '/u02/oradata/ORCL/system01.dbf';

# Ein bestimmtes Backup Set anzeigen
RMAN> LIST backupset 213;

# Ein Backup Set nach seinem Tag aussuchen
RMAN> LIST backupset TAG 'weekly_full_db_backup';

# Alle Image Copies einer Datendatei, die auf einem sbt-Ger&\"a&t liegen anzeigen
RMAN> LIST copy OF datafile '/u02/oradata/ORCL/system01.dbf'
2>    DEVICE TYPE sbt;

# Alle Backups anzeigen, die in einem bestimmten Verzeichnis liegen
RMAN> LIST backup LIKE '/tmp/%';

# Image Copies anzeigen, die in einem bestimmten Zeitraum fertiggestellt wurden
RMAN> LIST copy OF datafile 2 COMPLETED BETWEEN '10-DEC-2002' AND '17-DEC-2002';

# Alle Archive Logs, die mindestens zweimal auf Band gesichert wurden anzeigen
RMAN> LIST archivelog ALL BACKED UP 2 TIMES TO DEVICE TYPE sbt;

# Auflisten eines bestimmten Backupsets nach Tag
RMAN> LIST backupset TAG 'weekly_full_db_backup';
          \end{lstlisting}
    \section{Das Kommando REPORT}
      Das \languagerman{REPORT}-Kommando analysiert das RMAN Repository der Zieldatenbank, um Antworten auf verschiedene Fragen zu liefern.
      \subsection{Welche Dateien wurden noch nicht gesichert?}
        Erf\"ullt eine Datendatei die aktuelle Backup Retention Policy nicht, weil noch nicht gen\"ugende Backups vorliegen, bzw. das \"alteste Backup noch nicht alt genug ist, um das Recovery Window zu gew\"ahrleisten, kann dies mit dem Kommando \languagerman{REPORT NEED BACKUP} ermittelt werden.
        \begin{lstlisting}[caption={Wer verst\"o\ss{}t gegen die Retention Policy?},label=admin1353,language=rman]
RMAN> REPORT NEED BACKUP;

RMAN retention policy will be applied to the command
RMAN retention policy is set to redundancy 1
Report of files with less than 1 redundant backups
File #bkps Name
---- ----- -----------------------------------------------------
3    0     /u01/app/oracle/oradata/orcl/undotbs01.dbf
4    0     /u01/app/oracle/oradata/orcl/users01.dbf
5    0     /u01/app/oracle/oradata/orcl/example01.dbf
        \end{lstlisting}
        Die Ausgabe aus \beispiel{admin1353} zeigt an, dass bei einer redundanzbasierenden Retention Policy mit dem Wert 1, noch insgesamt 3 Datendateien gesichert werden m\"ussen, ehe die konfigurierte Policy eingehalten wird.

        Es ist auch m\"oglich, mit der \languagerman{NEED BACKUP}-Klausel eine andere Retention Policy zu unterstellen. Soll zum Beispiel gepr\"uft werden, welche Datendateien noch gesichert werden m\"ussten, wenn eine redundanzbasierende Retention Policy mit dem Wert 2 G\"ultigkeit h\"atte, wird die \languagerman{NEED BACKUP}-Klausel wie folgt erg\"anzt:
        \begin{lstlisting}[caption={Datenbankdateien die gesichert werden m\"ussen},label=admin1354,language=rman]
RMAN> REPORT NEED BACKUP REDUNDANCY 2;

Report of files with less than 2 redundant backups
File #bkps Name
---- ----- -----------------------------------------------------
1    1     /u01/app/oracle/oradata/orcl/system01.dbf
2    1     /u01/app/oracle/oradata/orcl/sysaux01.dbf
3    0     /u01/app/oracle/oradata/orcl/undotbs01.dbf
4    0     /u01/app/oracle/oradata/orcl/users01.dbf
5    0     /u01/app/oracle/oradata/orcl/example01.dbf
7    1     /u01/app/oracle/oradata/orcl/bank01.dbf
        \end{lstlisting}
        Der gleiche Vorgang ist auch f\"ur eine Zeitfensterbasierende Retention Policy m\"oglich.
        \begin{lstlisting}[caption={Datenbankdateien die gesichert werden m\"ussen},label=admin1355,language=rman]
RMAN> REPORT NEED BACKUP RECOVERY WINDOW OF 3 DAYS;

Report of files that must be backed up to satisfy 3 days recovery window
File Days  Name
---- ----- -----------------------------------------------------
1    4     /u01/app/oracle/oradata/orcl/system01.dbf
3    1535  /u01/app/oracle/oradata/orcl/undotbs01.dbf
4    1535  /u01/app/oracle/oradata/orcl/users01.dbf
5    67    /u01/app/oracle/oradata/orcl/example01.dbf
7    4     /u01/app/oracle/oradata/orcl/bank01.dbf
        \end{lstlisting}
        Die Spalte \identifier{Tage} gibt an, wie viele Archive Log Informationen, in Tagen gerechnet, eine Datendatei ben\"otigt, um vollst\"andig wiederhergestellt werden zu k\"onnen.
      \subsection{Nicht wiederherstellbare Datendateien aufsp\"uren}
        Nicht rekonstruierbare Operationen (unrecoverable operations) sind
        Schreibvorg\"ange in Datendateien, die unter Umgehung der SGA
        stattfinden. Dabei werden Informationen direkt in Datendateien
        geschrieben, ohne vorher durch den Database Buffer Cache geschleust zu
        werden. Ein solcher Schreibvorgang wird als \enquote{Direct Load}
        bezeichnet und hat den Vorteil, dass er sehr viel schneller ist, als ein
        normaler Schreibvorgang. Der Nachteil an einer solchen Vorgehensweise
        ist jedoch, dass keine Redo-Informationen erzeugt werden.

        Daraus resultiert, dass eine so behandelte Datendatei im Falle eines
        Crashes auch nicht mit Hilfe der Archive Logs wiederhergestellt werden
        kann. Die Empfehlung seitens Oracle ist deshalb, eine solche Datei
        umgehend in einem Backup zu sichern.
        \begin{lstlisting}[caption={Datenbankdateien die nicht rekonstruierbare Operationen enthalten aufsp\"uren},label=admin1356,language=rman]
RMAN> REPORT UNRECOVERABLE;

Report of files that need backup due to unrecoverable operations
File Type of Backup Required Name
---- ----------------------- -----------------------------------
5    full                    /u01/app/oracle/oradata/orcl/example01.dbf
        \end{lstlisting}
      \subsection{Nicht mehr ben\"otigte Backups}
        Wenn eine ausreichende Anzahl Backups vorhanden ist, um die geltende
        Retention Policy zu erf\"ullen, werden alle Backups, die nicht mehr
        ben\"otigt werden, als \enquote{obsolete} markiert. Eine Auflistung der
        obsoleten Backups kann mit \languagerman{REPORT OBSOLETE} angezeigt werden.
        \begin{lstlisting}[caption={Backups die nicht mehr ben\"otigt werden anzeigen},label=admin1357,language=rman]
RMAN> REPORT obsolete;

RMAN retention policy will be applied to the command
RMAN retention policy is set to redundancy 1
Report of obsolete backups and copies
Type                 Key    Completion Time    Filename/Handle
-------------------- ------ ------------------ --------------------
Backup Set           2      24-OCT-13
  Backup Piece       2      24-OCT-13          /u05/fast_recovery_area/ORCL/b...
Backup Set           4      24-OCT-13
  Backup Piece       4      24-OCT-13          /u05/fast_recovery_area/ORCL/...
        \end{lstlisting}
        Auch hierbei kann wieder eine ver\"anderte Retention Policy unterstellt werden, so wie es auch bei der \languagerman{NEED BACKUP}-Klausel m\"oglich ist.
        \begin{lstlisting}[caption={Backups die nicht mehr ben\"otigt werden anzeigen},label=admin1358,language=rman]
RMAN> REPORT obsolete RECOVERY WINDOW OF 3 DAYS;

Report of obsolete backups and copies
Type                 Key    Completion Time    Filename/Handle
-------------------- ------ ------------------ --------------------
Backup Set           2      24-OCT-13
  Backup Piece       2      24-OCT-13          /u05/fast_recovery_area/ORCL/b...
Backup Set           4      24-OCT-13
  Backup Piece       4      24-OCT-13          /u05/fast_recovery_area/ORCL/a...
        \end{lstlisting}
    \section{Erarbeiten von Backup und Recovery Strategien}
      \subsection{Redundancy Sets}
        Das Set der Dateien, das dazu ben\"otigt wird, um eine Datenbank im Fehlerfall zu Recovern wird als \enquote{Redundancy Set} bezeichnet. Ein solches Set sollte folgende Dateien enthalten:
        \begin{itemize}
          \item Das letzte Backup der Kontrolldatei und aller Datendateien
          \item Alle Archive Logs, die nach dem letzten Vollbackup entstanden sind
          \item Multiplexing Duplikate von Kontrolldateien und Redo Log Dateien
          \item Kopien von Konfigurationsdateien (SPFile, tnsnames.ora, listener.ora)
        \end{itemize}
        Aus Sicherheitsgr\"unden ist es wichtig, das Redundancy Set nicht auf dem gleichen Datentr\"ager aufzubewahrt, wie die Zieldatenbank selbst. Dies wird am Einfachsten dadurch erreicht, das eine Fast Recovery Area auf einem von der Datenbank getrennten Datentr\"ager eingerichtet wird. Unabh\"angig davon sollten folgende Empfehlungen beachtet werden:
        \begin{itemize}
          \item Kontroll- und Redo Log Dateien sollten auf Datenbankebene verteilt werden (Multiplexing).
          \item Wird die Datenbank im Archive Log Modus betrieben, sollten die Archive an unterschiedliche Stellen verteilt werden.
          \item F\"ur die Speicherung der Datendateien sollte Mirroring auf Betriebssystem- oder Hardwareebene genutzt werden.
          \item Es sollte immer mindestens eine Kopie des Redundancy Sets verf\"ugbar sein. Wird das Redundancy Set auf einem Band gespeichert, sollten aufgrund der hohen Ausfallwahrscheinlichkeit eines Bands immer mindestens zwei Kopien des Redundancy Sets vorhanden sein.
        \end{itemize}
        Die Nutzung einer Fast Recovery Area ist nicht  verpflichtend, wird
        jedoch seitens Oracle empfohlen.
      \subsection{Planen einer Backupstrategie}
        Eine Backupstrategie legt fest, welche Teile der Datenbank gesichert werden m\"ussen, welche Tools daf\"ur herangezogen werden und wie die Datenbank m\"oglichst robust konfiguriert werden kann, um Backup und Recovery Operationen zu erleichtern. Die Entwicklung einer Backupstrategie ist auch nicht zu letzt eine Frage des Budgets, da hochwertige Backupsysteme meist sehr kostspielig sind.
        \subsubsection{Archive Log oder Noarchive Log Modus}
          Die Datenbank kann in zwei verschiedenen Modi betrieben werden: Archivelog und Noarchivelog. Der Archivelog Modus erweitert die M\"oglichkeiten des DBA bei einem Recovery wesentlich, hat jedoch auch Nachteile, wie z. B. einen h\"oheren Speicherplatzverbrauch. Im Folgenden werden die Vor- und Nachteile dieser beiden Modi gegen\"ubergestellt. So kann eine Entscheidung getroffen werden, welcher Modus der Richtige f\"ur den Betrieb der Datenbank ist.

          Die Datenbank im Noarchivelog Modus zu betreiben, hat folgende Auswirkungen:
          \begin{itemize}
            \item Es k\"onnen keine Online-Backups gemacht werden. Die Datenbank muss vor einem Backup heruntergefahren werden.
            \item Erweiterte Recovery Techniken, wie z. B. Point-In-Time Recovery oder Flashback Database k\"onnen nicht genutzt werden.
          \end{itemize}
          Im Gegensatz dazu, hat der Betrieb der Datenbank im Archivelog Modus diese Auswirkungen:
          \begin{itemize}
            \item Die gesamte Breite der Recovery Techniken steht dem Administrator zur Verf\"ugung.
            \item Zus\"atzlicher Speicherplatz f\"ur die Speicherung der Archive Logs wird ben\"otigt.
            \item Die Archive Logs m\"ussen verwaltet werden (Bereitstellung von Speicherorten, Sicherung auf Band, usw.)
            \item Durch die Archivierung entsteht ein Performance Overhead.
          \end{itemize}
        \subsubsection{Festlegen der Backupfrequenz}
          Abh\"angig von der H\"aufigkeit, mit der eine Datenbank ge\"andert wird, sollte auch die Backupfrequenz bestimmt werden. Sie richtet sich nach den folgenden Gesichtspunkten:
          \begin{itemize}
            \item Wie h\"aufig werden Schemaobjekte gel\"oscht und neu angelegt?
            \item Wie h\"aufig werden Tabellenzeilen bearbeitet (eingef\"ugt, gel\"oscht, ge\"andert)?
            \item Wie h\"aufig wird die Struktur der Datenbank ge\"andert?
          \end{itemize}
          Von den Antworten auf diese Fragen, den vorhandenen Mitteln und der maximalen Down-Time, welche die Datenbank aufweisen darf, h\"angt ab, wie h\"aufig ein Backup der Datenbank erfolgen muss. Bei strukturellen \"Anderungen der Datenbank sollte grunds\"atzlich immer vorher und nachher ein Backup erfolgen.

          Wenn die \"Anderungsh\"aufigkeit f\"ur bestimmte Objekte sehr hoch ist und im Rest der Datenbank eher niedrig, kann auch ein partielles Backup der Datenbank in Frage kommen, so dass h\"aufig ge\"anderte Objekte auch h\"aufiger gesichert werden, als andere.
        \subsubsection{Wartungsfenster}
          Die Planung einer Backupstrategie h\"angt nicht zuletzt von evtl. vorhanden Wartungsfenstern ab.
          \begin{merke}
            Als Wartungsfenster wird ein Zeitraum bezeichnet, innerhalb dessen die Datenbank zu Wartungszwecken heruntergefahren werden kann.
          \end{merke}
          Da jede Datenbank einen bestimmten Verf\"ugbarkeitsgrad haben muss, also zu bestimmten Zeiten arbeitsbereit sein soll, werden die M\"oglichkeiten f\"ur Wartungsfenster automatisch eingeschr\"ankt.
        \subsubsection{Maximale Down-Time}
          \begin{merke}
            Als Down-Time wird der Zeitraum bezeichnet, in dem die Datenbank aufgrund eines Ausfalls nicht mehr verf\"ugbar ist. Hier gilt es m\"oglichst realistische Sch\"atzungen, evtl. auch basierend auf Erfahrungswerten, zu machen, wie lange ein schnellst m\"ogliches Recovery der Datenbank dauert und wie lange die Datenbank somit nicht verf\"ugbar sein wird. Die max. Down-Time sollte so gering wie m\"oglich gehalten werden.
          \end{merke}

          Da eine Backupstrategie die Basis f\"ur jede Recoverystrategie darstellt, muss die max. Down-Time nicht erst beim Erstellen der Recoverystrategie(n) ber\"ucksichtig werden, sondern bereits hier.
          \abbildung{backupstrategie} zeigt eine m\"ogliche Vorgehensweise bei der Planung einer Backupstrategie.
          \bild{Planung einer Backupstrategie}{backupstrategie}{0.45}
\clearpage
      \subsection{RMAN-Skripte benutzen}
        RMAN stellt die M\"oglichkeit bereit, Skripte f\"ur st\"andig wiederkehrende Aufgaben zu benutzen. Dabei handelt es sich um einfache Textdateien, die auf jeder Betriebssystemplattform erstellt und genutzt werden k\"onnen. Aus diesem Grund stellen RMAN-Skripte das ideale Hilfsmittel zur Implementierung einer Backupstrategie dar.
        \subsubsection{RMAN mit Skript-Datei starten}
          \begin{lstlisting}[caption={Aufrund eines RMAN-Skripts},label=admin1359,language=rman]
[oracle@FEA11-119SRV ~]$ rman target / cmdfile backup_sunday_full.cmd
          \end{lstlisting}
          \begin{merke}
            Die Dateiendung \oscommand{.cmd} wurde willk\"urlich gew\"ahlt.
          \end{merke}
          Nach der Ausf\"uhrung aller Kommandos im Skript, wird RMAN automatisch beendet. Um die Ausgaben des RMAN-Skripts sehen zu k\"onnen, kann zus\"atzlich eine Logdatei Angegeben werden.
          \begin{lstlisting}[caption={RMAN-Skript mit Log-Datei benutzen},label=admin1360,language=terminal]
[oracle@FEA11-119SRV ~]$ rman target / cmdfile backup_sunday_full.cmd \
> log backup_sunday_full.log
          \end{lstlisting}
        \subsubsection{Skript-Dateien in RMAN starten}
          RMAN-Skripte k\"onnen auch innerhalb von RMAN aufgerufen werden:
          \begin{lstlisting}[caption={Ein Skript-Datei in RMAN aufrufen},label=admin1361,language=rman]
RMAN> @backup_sunday_full.cmd
        \end{lstlisting}
          Wurden die Kommandos im RMAN-Skript ausgef\"uhrt, zeigt RMAN die Meldung \enquote{**end-of-file**} und wird nicht beendet.
        \subsubsection{Syntax Check}
          RMAN bietet die M\"oglichkeit, einen Syntax-Check an Skript-Dateien durchzuf\"uhren. Dies geschieht mit Hilfe des Parameters \oscommand{CHECKSYNTAX}. Wird RMAN mit diesem Parameter aufgerufen, werden alle Kommandos nur getestet und nicht ausgef\"uhrt. Ist ein Kommando fehlerhaft, wird die RMAN-Fehlermeldung \enquote{RMAN-00558} ausgegeben.
          \begin{lstlisting}[caption={Ein RMAN-Skript auf korrekte Syntax \"uberpr\"ufen},label=admin1362,language=rman]
[oracle@FEA11-119SRV ~]$ rman checksyntax cmdfile backup_sunday_full.cmd

Recovery Manager: Release 11.2.0.1.0 - Production on Sun Oct 27 08:51:42 2013

Copyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.

RMAN> BACKUP database;
The cmdfile has no syntax errors
Recovery Manager complete.
          \end{lstlisting}
      \subsection{Planen einer Recoverystrategie}
        Die Fehler, die in einer Datenbank entstehen k\"onnen, decken die
        gesamte Skala von Nutzer\-fehlern, \"uber Blockfehler in Datendateien
        bis hin zu Medienfehlern ab. Wie schnell ein Fehler behoben
        werden kann, h\"angt im Wesentlichen von der Recoverystrategie ab.

        Vor der Erstellung einer Recoverystrategie sollten folgende Fragen beantwortet werden:
        \begin{itemize}
          \item Wie soll auf den Ausfall eines gesamten Speichermediums reagiert werden?
          \item Wie kann ein logischer Fehler, der durch eine Anwendung erzeugt wurde, aufgesp\"urt und behoben werden?
            \begin{itemize}
              \item Welche Auswirkungen entstehen dabei auf zwischenzeitlich durchgef\"uhrte Updates?
              \item Wie kann ein erneutes Auftreten des gleichen Fehlers verhindert werden?
            \end{itemize}
          \item Wie soll reagiert werden, wenn das Alert.log File einen oder mehrere defekte Datenbl\"ocke in den Datendateien anzeigt und wie k\"onnen diese Bl\"ocke repariert werden?
          \item Welches Disaster Recovery ist im Falle der Zerst\"orung des kompletten Datenbankservers notwendig und wie lange w\"urde ein solches Recovery dauern?
          \item Kann eine andere Person, die Datenbank Recovern, falls der DBA abwesend ist?
        \end{itemize}
        Wurden Antworten auf diese Fragen gefunden, kann gekl\"art werden, welche Techniken beim Recovery zum Einsatz kommen sollen. Hier stehen zur Verf\"ugung:
        \begin{itemize}
          \item User Managed Backup and Recovery
          \item Der Recovery Manager
          \item Oracle Flashback Database
          \item Block Media Recovery
        \end{itemize}
        Dies sind jedoch nur einige wenige \"Uberlegungen, die bei der Planung einer Recoverystrategie gemacht werden sollten. Zus\"atzlich kommt es immer auf Hardware, Personal und Budget an.
    \section{Ein Backupszenario}
      \label{backupszenarios}
      \subsection{Backupstrategie bei hohem \"Anderungsvolumen}
        In diesem Szenario wird eine Datenbank beschrieben, f\"ur die eine w\"ochentliche Sicherung eingerichtet werden soll. Das \"Anderungsvolumen dieser Datenbank, innerhalb einer Woche, ist hoch. Da in einem solchen Szenario selbst inkrementelle Backups sehr gro\ss\ werden k\"onnen, wird hier ein w\"ochentliches Full-Backup mit zus\"atzlicher Sicherung der Archive Logs und einer Zeitfensterbasierten Retention Policy empfohlen.

        Die Strategie setzt sich aus den folgenden einzelnen Elementen zusammen:
        \begin{itemize}
          \item Die Redo Logs werden mit Hilfe der Fast Recovery Area gesichert.
          \item W\"ochentlich wird ein Full-Backup der Datenbank in die Fast Recovery Area gesichert.
          \item T\"aglich werden alle Backupdateien (einschlie\ss{}lich der Archive Logs), die sich in der Fast Recovery Area befinden auf ein SBT-Ger\"at gesichert. Obsolete Backups werden vom SBT gel\"oscht.
        \end{itemize}
        Wird f\"ur die Backupstrategie eine Recovery Window basierte Retention Policy verwendet, ist sichergestellt, dass alle Backups, solange sie ben\"otigt werden, vorr\"atig sind.
        \subsubsection{Vorbereitungen}
          Vorbereitend f\"ur diese Backupstrategie muss eine Fast Recovery Area mit der richtigen Gr\"o\ss{}e erstellt werden. Diese kann nach folgender Formel berechnet werden:

          \begin{small}
            Speicherplatzbedarf = (Gr\"o\ss{}e eines Full-Backups) + (Gr\"o\ss{}e aller Archive Logs f\"ur Y+1 Tage)
          \end{small}

          Die Variable $Y$ steht in dieser Formel f\"ur die Anzahl der Tage, die zwischen den Sicherungen der Fast Recovery Area vergehen. In diesem Szenario erfolgt eine t\"agliche Sicherung, d. h. es gilt $Y=1$. Wichtig ist ebenfalls, dass die Fast Recovery Area als Speicherort f\"ur die Redo Logs angegeben wird.

          Zur Umsetzung dieser Strategie werden zwei verschiedene RMAN-Skripte benutzt. Eines f\"ur das w\"ochentliche Full-Backup und eines f\"ur die t\"aglichen Backups der Fast Recovery Area. Das w\"ochentliche Skript wird jeden Sonntag ausgef\"uhrt. Das t\"agliche Skript wird sechs Tage die Woche ausgef\"uhrt.
\clearpage
        \subsubsection{Das w\"ochentliche Skript}
          \begin{lstlisting}[caption={Das w\"ochentliche Skript},label=admin1363,language=rman]

RMAN> RUN {
2>      ALLOCATE CHANNEL c1 DEVICE TYPE disk;
3>      ALLOCATE CHANNEL c2 DEVICE TYPE sbt
4>      PARMS 'SBT_LIBRARY=oracle.disksbt,ENV=(BACKUP_DIR=/u04)';
5>
6>      BACKUP AS COMPRESSED BACKUPSET database
7>      CHANNEL c1;
8>
9>      BACKUP recovery area
10>      CHANNEL c2;
11>
12>     DELETE obsolete DEVICE TYPE sbt;
13>   }
          \end{lstlisting}
        \subsubsection{Das t\"agliche Skript}
          \begin{lstlisting}[caption={Das t\"agliche Skript},label=admin1364,language=rman]
RMAN> RUN {
3>      ALLOCATE CHANNEL c2 DEVICE TYPE sbt
4>      PARMS 'SBT_LIBRARY=oracle.disksbt,ENV=(BACKUP_DIR=/u04)';
5>
5>      BACKUP recovery area
6>      CHANNEL c2;
7>
8>      DELETE obsolete DEVICE TYPE sbt;
9>    }
          \end{lstlisting}
          Da t\"aglich die gesamte Fast Recovery Area gesichert wird, kann der RMAN, Dateien aus der Recovery Area l\"oschen, sobald dies notwendig ist. Zwischen den einzelnen Backups ist es schwierig zu sagen, welche Dateien noch in der Fast Recovery Area sind.
    \section{Informationen}
      \subsection{Verzeichnis der relevanten Data Dictionary Views}
        \begin{literaturinternet}
          \item \cite{REFRN30022}
          \item \cite{REFRN30030}
        \end{literaturinternet}
\clearpage
